<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.ljl.TwoLoanDaoLjl" >
	<!-- parameterType="com.entity.tzt.Orders" -->
	<select id="AllReturn" resultType="map">
		select * from (select proid,dreturn,zreturn,wreturn,dreturn+zreturn+wreturn as totalreturn,wreturn || '/' || (dreturn+zreturn+wreturn) || '（完成率' || (wreturn/(dreturn+zreturn+wreturn)*100) || '%）' as completerate
		from (select projectsid as proid,
		sum(case when ord_status =80 then 1 else 0 end) as dreturn,
		sum(case when ord_status =96 then 1 else 0 end) as zreturn,
		sum(case when ord_status =81 then 1 else 0 end) as wreturn
		from orders group by projectsid)) orders,projects p,projects_describe pb,pro_money pm where orders.proid=p.projectsid 
		and pb.projectsid=p.projectsid and pm.projectsid=p.projectsid and p.projectsstate=85
	</select>
	<update id="UpdateProState" parameterType="map">
		update projects set projectsstate=#{projectsstate} where empid=#{empid} and projectsid=#{projectsid}
	</update>
</mapper>